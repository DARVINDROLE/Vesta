<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Meteor Trajectory Predictor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        header { text-align: center; padding: 40px 20px; background: rgba(255,255,255,0.05); border-radius:15px; margin-bottom:30px; backdrop-filter: blur(10px); }
        h1 {
            font-size: 3em;
            background: linear-gradient(135deg,#ff6b6b,#ffa07a,#ff6b6b);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle { font-size:1.2em; color:#a0a0a0; }
        .api-status { display:inline-block; padding:5px 15px; border-radius:20px; font-size:0.9em; margin-top:10px; }
        .status-healthy { background: rgba(76,175,80,0.3); color:#4caf50; }
        .status-error { background: rgba(244,67,54,0.3); color:#f44336; }

        .tabs { display:flex; gap:10px; margin-bottom:30px; flex-wrap:wrap; }
        .tab { flex:1; min-width:150px; padding:15px 20px; background: rgba(255,255,255,0.05); border:2px solid transparent; border-radius:10px; cursor:pointer; transition:all .3s; text-align:center; }
        .tab:hover { background: rgba(255,255,255,0.1); border-color: rgba(255,107,107,0.5); }
        .tab.active { background: rgba(255,107,107,0.2); border-color:#ff6b6b; }

        .tab-content { display:none; animation:fadeIn .5s; }
        .tab-content.active { display:block; }
        @keyframes fadeIn { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform:translateY(0); } }

        .card { background: rgba(255,255,255,0.05); border-radius:15px; padding:30px; margin-bottom:20px; backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,0.1); }
        .card h2 { color:#ff6b6b; margin-bottom:20px; font-size:1.8em; }

        .form-group { margin-bottom:20px; }
        label { display:block; margin-bottom:8px; color:#b0b0b0; font-size:0.95em; }
        input, select { width:100%; padding:12px 15px; background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.2); border-radius:8px; color:#e0e0e0; font-size:1em; transition:all .3s; }
        input:focus, select:focus { outline:none; border-color:#ff6b6b; background: rgba(255,255,255,0.12); }

        .btn { padding:12px 30px; background: linear-gradient(135deg,#ff6b6b,#ffa07a); border:none; border-radius:8px; color:white; font-size:1.1em; font-weight:bold; cursor:pointer; transition:all .3s; margin-right:10px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(255,107,107,0.4); }
        .btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; }
        .btn-secondary { background: rgba(255,255,255,0.1); }

        .results { margin-top:30px; }
        .result-card { background: rgba(255,255,255,0.08); border-radius:12px; padding:20px; margin-bottom:15px; border-left:4px solid #ff6b6b; }
        .result-title { font-size:1.3em; color:#ffa07a; margin-bottom:10px; }
        .result-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap:15px; margin-top:15px; }
        .result-item { background: rgba(0,0,0,0.2); padding:15px; border-radius:8px; }
        .result-label { font-size:0.85em; color:#a0a0a0; margin-bottom:5px; }
        .result-value { font-size:1.3em; color:#fff; font-weight:bold; }

        .risk-critical { color:#ff1744; }
        .risk-high { color:#ff6b6b; }
        .risk-moderate { color:#ffa726; }
        .risk-low { color:#ffeb3b; }
        .risk-minimal { color:#4caf50; }

        .loading { text-align:center; padding:40px; }
        .spinner { border:4px solid rgba(255,255,255,0.1); border-top:4px solid #ff6b6b; border-radius:50%; width:50px; height:50px; animation:spin 1s linear infinite; margin:0 auto 20px; }
        @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

        .neo-list { max-height:600px; overflow-y:auto; }
        .neo-item { background: rgba(255,255,255,0.05); padding:15px; margin-bottom:10px; border-radius:8px; cursor:pointer; transition:all .3s; border-left:3px solid transparent; }
        .neo-item:hover { background: rgba(255,255,255,0.1); border-left-color:#ff6b6b; transform: translateX(5px); }
        .neo-item.hazardous { border-left-color:#ff1744; }
        .neo-name { font-weight:bold; color:#ffa07a; margin-bottom:5px; }
        .neo-details { font-size:0.9em; color:#b0b0b0; }
        .badge { display:inline-block; padding:3px 8px; border-radius:12px; font-size:0.75em; margin-left:5px; }
        .badge-danger { background: rgba(255,23,68,0.3); color:#ff1744; }

        .trajectory-viz { background: rgba(0,0,0,0.3); border-radius:12px; padding:20px; margin-top:20px; min-height:300px; position:relative; }
        .error-message { background: rgba(244,67,54,0.2); border:1px solid #f44336; border-radius:8px; padding:15px; color:#ff6b6b; margin-top:15px; }
        .info-box { background: rgba(33,150,243,0.2); border:1px solid #2196f3; border-radius:8px; padding:15px; color:#64b5f6; margin-bottom:20px; }

        .trajectory-points { max-height:400px; overflow-y:auto; background: rgba(0,0,0,0.2); padding:15px; border-radius:8px; margin-top:15px; }
        .trajectory-point { font-family:'Courier New', monospace; font-size:0.85em; padding:5px; border-bottom:1px solid rgba(255,255,255,0.05); }

        .viz-container { display:flex; gap:20px; align-items:flex-start; margin-top:15px; flex-wrap:wrap; }
        #orbitCanvas { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:8px; width: 520px; height: 520px; box-shadow: 0 6px 20px rgba(0,0,0,0.6); }
        .viz-side { flex:1; min-width:220px; max-width:360px; }
        .legend { background: rgba(255,255,255,0.03); padding:12px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); }
        .legend h4 { margin-bottom:8px; color:#ffa07a; }
        .legend-row { display:flex; align-items:center; gap:10px; margin-bottom:8px; }
        .swatch { width:18px; height:10px; display:inline-block; border-radius:3px; border:1px solid rgba(255,255,255,0.06); }
        .tooltip { position:absolute; pointer-events:none; transform: translate(-50%, -120%); background: rgba(0,0,0,0.8); color:#fff; padding:6px 8px; border-radius:6px; font-size:12px; display:none; z-index:50; white-space:nowrap; }
        .closest-label { margin-top:8px; font-size:0.9em; color:#ffd6a5; }
        @media (max-width: 900px) { #orbitCanvas { width: 360px; height:360px; } }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Meteor Trajectory Predictor</h1>
            <p class="subtitle">NASA-powered trajectory analysis & impact probability calculation</p>
            <div class="api-status" id="apiStatus">Checking API...</div>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('meteors', event)">NEOs Feed</div>
            <div class="tab" onclick="switchTab('browse', event)">Browse NEOs</div>
        </div>

        <div id="meteors" class="tab-content active">
            <div class="card">
                <h2>Upcoming NEO Close Approaches</h2>
                <div class="info-box">View asteroids approaching Earth in the next 7 days</div>

                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" id="feedStartDate" />
                </div>

                <div class="form-group">
                    <label>End Date</label>
                    <input type="date" id="feedEndDate" />
                </div>

                <button class="btn" onclick="getFeed()">Get NEO Feed</button>

                <div id="feedResults" class="results"></div>
            </div>
        </div>

        <div id="browse" class="tab-content">
            <div class="card">
                <h2>Browse All Near Earth Objects</h2>
                <div class="form-group">
                    <label>Page Number</label>
                    <input type="number" id="browsePage" value="0" min="0" />
                </div>

                <button class="btn" onclick="browseNEOs()">Load NEOs</button>

                <div id="browseResults" class="results"></div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="vizTooltip"></div>

    <script>
        const API_BASE = 'https://trajectory-api.onrender.com';
        let currentTab = 'meteors';

        window.onload = async () => {
            const today = new Date().toISOString().split('T')[0];
            const nextWeek = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            document.getElementById('feedStartDate').value = today;
            document.getElementById('feedEndDate').value = nextWeek;

            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();

                const statusEl = document.getElementById('apiStatus');
                if (data.status === 'healthy') {
                    statusEl.className = 'api-status status-healthy';
                    statusEl.textContent = 'API Online';
                } else {
                    throw new Error('API unhealthy');
                }
            } catch (error) {
                const statusEl = document.getElementById('apiStatus');
                statusEl.className = 'api-status status-error';
                statusEl.textContent = 'API Offline';
            }
        };

        function switchTab(tabName, event) {
            currentTab = tabName;
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        async function getFeed() {
            const startDate = document.getElementById('feedStartDate').value;
            const endDate = document.getElementById('feedEndDate').value;
            const resultsEl = document.getElementById('feedResults');

            resultsEl.innerHTML = '<div class="loading"><div class="spinner"></div>Loading NEO feed...</div>';

            try {
                const response = await fetch(
                    `${API_BASE}/meteors/feed?start_date=${startDate}&end_date=${endDate}`
                );
                const data = await response.json();

                if (!response.ok) throw new Error(data.detail || 'Failed to fetch');

                let html = `<div class="result-card">
                    <div class="result-title">${data.element_count} Objects Approaching (${startDate} to ${endDate})</div>
                    <div class="neo-list">`;

                data.approaching_objects.forEach(neo => {
                    const hazardClass = neo.is_potentially_hazardous ? 'hazardous' : '';
                    const hazardBadge = neo.is_potentially_hazardous
                        ? '<span class="badge badge-danger">HAZARDOUS</span>'
                        : '';

                    html += `<div class="neo-item ${hazardClass}" onclick="analyzeNEO('${neo.id}')">
                        <div class="neo-name">${neo.name} ${hazardBadge}</div>
                        <div class="neo-details">
                            ${neo.close_approach_date} |
                            ${(neo.miss_distance_km / 384400).toFixed(2)} Lunar Distances |
                            ${(neo.relative_velocity_kmh / 1000).toFixed(0)} km/s |
                            ~${(neo.estimated_diameter_km * 1000).toFixed(0)}m diameter
                        </div>
                    </div>`;
                });

                html += '</div></div>';
                resultsEl.innerHTML = html;
            } catch (error) {
                resultsEl.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
            }
        }

        async function analyzeNEO(neoId) {
            const resultsEl = document.getElementById('feedResults');
            resultsEl.innerHTML = '<div class="loading"><div class="spinner"></div>Analyzing NEO trajectory...</div>';

            try {
                const response = await fetch(
                    `${API_BASE}/meteors/${neoId}/trajectory?days_forward=365`,
                    { method: 'POST' }
                );
                const data = await response.json();

                if (!response.ok) throw new Error(data.detail || 'Failed to fetch');

                displayTrajectoryResults(data, resultsEl);
            } catch (error) {
                resultsEl.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
            }
        }

        async function browseNEOs() {
            const page = document.getElementById('browsePage').value;
            const resultsEl = document.getElementById('browseResults');

            resultsEl.innerHTML = '<div class="loading"><div class="spinner"></div>Loading NEOs...</div>';

            try {
                const response = await fetch(`${API_BASE}/meteors/browse?page=${page}&size=20`);
                const data = await response.json();

                if (!response.ok) throw new Error(data.detail || 'Failed to fetch');

                let html = `<div class="result-card">
                    <div class="result-title">Page ${data.page + 1} of NEO Database (${data.total_elements} total)</div>
                    <div class="neo-list">`;

                data.neos.forEach(neo => {
                    const hazardClass = neo.is_potentially_hazardous ? 'hazardous' : '';
                    const hazardBadge = neo.is_potentially_hazardous
                        ? '<span class="badge badge-danger">PHA</span>'
                        : '';

                    html += `<div class="neo-item ${hazardClass}" onclick="analyzeNEO('${neo.id}')">
                        <div class="neo-name">${neo.name} ${hazardBadge}</div>
                        <div class="neo-details">
                            H = ${neo.absolute_magnitude} |
                            Diameter: ${(neo.estimated_diameter_km_min * 1000).toFixed(0)}-${(neo.estimated_diameter_km_max * 1000).toFixed(0)}m
                        </div>
                    </div>`;
                });

                html += '</div></div>';
                html += `<button class="btn" style="margin-top:20px;" onclick="document.getElementById('browsePage').value = ${data.page + 1}; browseNEOs();">Next Page</button>`;

                if (page > 0) {
                    html += `<button class="btn btn-secondary" style="margin-top:20px;" onclick="document.getElementById('browsePage').value = ${data.page - 1}; browseNEOs();">Previous Page</button>`;
                }

                resultsEl.innerHTML = html;
            } catch (error) {
                resultsEl.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
            }
        }

        function displayTrajectoryResults(data, container) {
            const riskClass = getRiskClass(data.risk_assessment);

            let html = `
                <div class="result-card">
                    <div class="result-title">${data.name}</div>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">Impact Probability</div>
                            <div class="result-value">${(data.impact_probability * 100).toExponential(2)}%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Risk Assessment</div>
                            <div class="result-value ${riskClass}">${data.risk_assessment.split(' - ')[0]}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Diameter Range</div>
                            <div class="result-value">${(data.estimated_diameter_km_min * 1000).toFixed(0)}-${(data.estimated_diameter_km_max * 1000).toFixed(0)}m</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">MOID</div>
                            <div class="result-value">${data.minimum_orbit_intersection_distance_au.toFixed(4)} AU</div>
                        </div>
                    </div>
                </div>`;

            if (data.orbital_period_days) {
                html += `<div class="result-card">
                    <div class="result-title">Orbital Information</div>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">Orbital Period</div>
                            <div class="result-value">${data.orbital_period_days.toFixed(1)} days</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Years</div>
                            <div class="result-value">${(data.orbital_period_days / 365.25).toFixed(2)} years</div>
                        </div>
                    </div>
                </div>`;
            }

            if (data.close_approach_date) {
                html += `<div class="result-card">
                    <div class="result-title">Close Approach Data</div>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">Date</div>
                            <div class="result-value">${data.close_approach_date}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Distance</div>
                            <div class="result-value">${(data.close_approach_distance_km / 384400).toFixed(2)} LD</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Velocity</div>
                            <div class="result-value">${(data.relative_velocity_kmh / 1000).toFixed(1)} km/s</div>
                        </div>
                    </div>
                </div>`;
            }

            html += `<div class="trajectory-viz">
                <strong>Trajectory Points Generated:</strong> ${data.trajectory_points.length}<br>
                <small>Simulated ${data.trajectory_points[data.trajectory_points.length - 1].day} days forward</small>
                <div class="trajectory-points">`;

            const showPoints = 10;
            const points = data.trajectory_points;

            for (let i = 0; i < Math.min(showPoints, points.length); i++) {
                const p = points[i];
                html += `<div class="trajectory-point">Day ${p.day}: [${p.x_au.toFixed(4)}, ${p.y_au.toFixed(4)}, ${p.z_au.toFixed(4)}] AU | Sun: ${p.distance_from_sun_au.toFixed(4)} AU | Earth: ${p.distance_to_earth_au.toFixed(4)} AU</div>`;
            }

            if (points.length > showPoints * 2) {
                html += `<div class="trajectory-point">... ${points.length - showPoints * 2} more points ...</div>`;
            }

            for (let i = Math.max(showPoints, points.length - showPoints); i < points.length; i++) {
                const p = points[i];
                html += `<div class="trajectory-point">Day ${p.day}: [${p.x_au.toFixed(4)}, ${p.y_au.toFixed(4)}, ${p.z_au.toFixed(4)}] AU | Sun: ${p.distance_from_sun_au.toFixed(4)} AU | Earth: ${p.distance_to_earth_au.toFixed(4)} AU</div>`;
            }

            html += `</div>
                <div class="viz-container" style="margin-top:15px;">
                    <canvas id="orbitCanvas" width="520" height="520"></canvas>
                    <div class="viz-side">
                        <div class="legend">
                            <h4>Visualization Legend</h4>
                            <div class="legend-row"><span class="swatch" style="background:#ffd54f"></span> Sun</div>
                            <div class="legend-row"><span class="swatch" style="background:rgba(255,255,255,0.06); border:1px dashed rgba(255,255,255,0.06)"></span> Earth's Orbit (1 AU)</div>
                            <div class="legend-row"><span class="swatch" style="background:#43a047"></span> Far (large distance)</div>
                            <div class="legend-row"><span class="swatch" style="background:#ffca28"></span> Medium</div>
                            <div class="legend-row"><span class="swatch" style="background:#ff7043"></span> Close</div>
                            <div class="legend-row"><span class="swatch" style="background:#e53935"></span> Very Close</div>
                            <div class="closest-label" id="closestLabel"></div>
                        </div>
                        <div style="height:10px"></div>
                        <div style="font-size:0.9em; color:#b0b0b0; margin-top:12px;">
                            This is a top-down Sun-centered view. Coordinates are in AU. Points colored by proximity to Earth.
                        </div>
                    </div>
                </div>
            </div>`;

            container.innerHTML = html;

            try {
                renderTrajectoryCanvas(points);
            } catch (e) {
                console.warn('Trajectory canvas failed:', e);
            }
        }

        function getRiskClass(riskText) {
            if (riskText.includes('CRITICAL')) return 'risk-critical';
            if (riskText.includes('HIGH')) return 'risk-high';
            if (riskText.includes('MODERATE')) return 'risk-moderate';
            if (riskText.includes('LOW')) return 'risk-low';
            return 'risk-minimal';
        }

        function renderTrajectoryCanvas(points) {
            const canvas = document.getElementById('orbitCanvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const w = canvas.width;
            const h = canvas.height;
            ctx.clearRect(0, 0, w, h);

            const margin = 24;
            const maxPointRadius = Math.max(...points.map(p => Math.hypot(p.x_au || p.x, p.y_au || p.y)));
            const maxRadius = Math.max(1.0, maxPointRadius);
            const scale = (Math.min(w, h) / 2 - margin) / maxRadius;

            const cx = w / 2;
            const cy = h / 2;

            ctx.save();
            ctx.beginPath();
            ctx.arc(cx, cy, 8, 0, Math.PI * 2);
            ctx.fillStyle = '#ffd54f';
            ctx.fill();
            ctx.closePath();

            ctx.beginPath();
            ctx.arc(cx, cy, scale * 1.0, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255,255,255,0.08)';
            ctx.lineWidth = 1.2;
            ctx.stroke();
            ctx.closePath();

            const earthX = cx + scale * 1.0;
            const earthY = cy;
            ctx.beginPath();
            ctx.arc(earthX, earthY, 6, 0, Math.PI * 2);
            ctx.fillStyle = '#4fc3f7';
            ctx.fill();
            ctx.closePath();

            ctx.font = '12px Segoe UI, sans-serif';
            ctx.fillStyle = '#9be7ff';
            ctx.textAlign = 'left';
            ctx.fillText('Earth (1 AU)', earthX + 8, earthY + 4);

            const pts2D = points.map((p, idx) => {
                const x = (p.x_au !== undefined) ? p.x_au : p.x;
                const y = (p.y_au !== undefined) ? p.y_au : p.y;
                return {
                    idx,
                    day: p.day,
                    x_c: cx + x * scale,
                    y_c: cy - y * scale,
                    x_au: x,
                    y_au: y,
                    z_au: p.z_au !== undefined ? p.z_au : (p.z || 0),
                    distance_to_earth_au: p.distance_to_earth_au !== undefined ? p.distance_to_earth_au : (p.distance_to_earth || p.distance_to_earth_au),
                    distance_from_sun_au: p.distance_from_sun_au !== undefined ? p.distance_from_sun_au : (p.distance_from_sun || p.distance_from_sun_au)
                };
            });

            ctx.beginPath();
            for (let i = 0; i < pts2D.length; i++) {
                const pt = pts2D[i];
                if (i === 0) ctx.moveTo(pt.x_c, pt.y_c);
                else ctx.lineTo(pt.x_c, pt.y_c);
            }
            ctx.strokeStyle = 'rgba(255,255,255,0.15)';
            ctx.lineWidth = 1.0;
            ctx.stroke();
            ctx.closePath();

            let closestIdx = 0;
            let minDist = Infinity;
            pts2D.forEach((p, i) => {
                if (p.distance_to_earth_au < minDist) { minDist = p.distance_to_earth_au; closestIdx = i; }
            });

            for (let i = 0; i < pts2D.length; i++) {
                const p = pts2D[i];
                const color = mapDistanceToColor(p.distance_to_earth_au);
                ctx.beginPath();
                ctx.arc(p.x_c, p.y_c, (i === closestIdx ? 4.5 : 3.0), 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
                ctx.closePath();
            }

            const closestPoint = pts2D[closestIdx];
            ctx.beginPath();
            ctx.arc(closestPoint.x_c, closestPoint.y_c, 8, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255, 99, 71, 0.95)';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.closePath();

            const closestLabel = document.getElementById('closestLabel');
            if (closestLabel) {
                closestLabel.innerHTML = `Closest Approach: Day ${closestPoint.day} — ${closestPoint.distance_to_earth_au.toFixed(4)} AU (${(closestPoint.distance_to_earth_au * 149597870.7 / 1000).toFixed(0)} thousand km)`;
            }

            const tooltip = document.getElementById('vizTooltip');
            canvas.onmousemove = function(evt) {
                const rect = canvas.getBoundingClientRect();
                const mx = evt.clientX - rect.left;
                const my = evt.clientY - rect.top;
                let hit = null;
                for (let p of pts2D) {
                    const dx = mx - p.x_c;
                    const dy = my - p.y_c;
                    if (Math.hypot(dx, dy) <= 6) { hit = p; break; }
                }
                if (hit) {
                    tooltip.style.display = 'block';
                    tooltip.style.left = (evt.clientX) + 'px';
                    tooltip.style.top = (evt.clientY - 10) + 'px';
                    tooltip.innerHTML = `Day ${hit.day} — Sun ${hit.distance_from_sun_au.toFixed(3)} AU — Earth ${hit.distance_to_earth_au.toFixed(4)} AU`;
                } else {
                    tooltip.style.display = 'none';
                }
            };

            canvas.onmouseleave = function() { tooltip.style.display = 'none'; };
        }

        function mapDistanceToColor(distAu) {
            const d = (distAu === undefined || distAu === null) ? 10 : Math.max(0, distAu);

            if (d <= 0.005) return '#e53935';
            if (d <= 0.02) return '#ff7043';
            if (d <= 0.1) return '#ffca28';
            if (d <= 0.5) return '#66bb6a';
            return '#42a5f5';
        }

    </script>
</body>
</html>
